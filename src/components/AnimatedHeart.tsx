import React, { use, useEffect, useRef } from 'react';
import { gsap } from 'gsap';
import { DrawSVGPlugin } from "gsap/DrawSVGPlugin";
import AnimatedHeart_aorta from '../assets/AnimatedHeart_aorta.png';
import AnimatedHeart_cava from '../assets/AnimatedHeart_cava.png';
import AnimatedHeart_heart from '../assets/AnimatedHeart_heart.png';
import AnimatedHeart_artery from '../assets/AnimatedHeart_artery.png';
import AnimatedHeart_veins from '../assets/AnimatedHeart_veins.png';
import AnimatedHeart_atrium from '../assets/AnimatedHeart_atrium.png';
import AnimatedHeart_hours from '../assets/AnimatedHeart_hours.png';
import AnimatedHeart_minutes from '../assets/AnimatedHeart_minutes.png';

gsap.registerPlugin(DrawSVGPlugin);

const AnimatedHeart = () => {
    const containerRef = useRef(null);
    const pathRef = useRef(null);

    //Heart Animation
    useEffect(() => {
        const tl = gsap.timeline({ repeat: -1, yoyo: true });
        tl.to('.aorta', { scale: .95, x:30, y:30, duration: 1, ease: 'sine.inOut' }, 0)
        .to('.outline3', { scale: .95, x:30, y:30, duration: 1, ease: 'sine.inOut' }, 0)
        .to('.cava', { scale: 1.05, rotation: 1, duration: 1, ease: 'sine.inOut' }, 0)
        .to('.outline2', { scale: 1.05, rotation: 1, duration: 1, ease: 'sine.inOut' }, 0)
        .to('.heart', { scale: 1.05, x:-40, y:-30, duration: 1, ease: 'sine.inOut' }, 0)
        .to('.outline1', { scale: 1.05, x:-40, y:-30, duration: 1, ease: 'sine.inOut' }, 0)
        .to('.artery', { scale: .97, y:20, duration: 1, ease: 'sine.inOut' }, 0)
        .to('.veins', { scale: 1.05, x:-40, y:-30, opacity: .5, duration: 1, ease: 'sine.inOut' }, 0)
        .to('.atrium', { rotation: 1, duration: 1, ease: 'sine.inOut' }, 0)
        .to('.hours', { x: -10, duration: 1, ease: 'sine.inOut' }, 0)
        .to('.minutes', { x: -10, duration: 1, ease: 'sine.inOut' }, 0)
        .to('.outline4', { x: -10, duration: 1, ease: 'sine.inOut' }, 0)
        .to('.outline5', { x: -10, duration: 1, ease: 'sine.inOut' }, 0);

        const animateBlueIn = () => {
            const duration = gsap.utils.random(5, 10); // random duration between 1s and 3s
            const delay = gsap.utils.random(0, 5);  // random delay between 0.5s and 2s
            
            gsap.fromTo('.outline1', { drawSVG: "0%"}, { drawSVG: "100%", duration: duration, delay: delay, ease: "power1.inOut" });
            gsap.fromTo('.outline2', { drawSVG: "0%"}, { drawSVG: "1000%", duration: duration, delay: delay, ease: "power1.inOut", onComplete: animateBlueOut });
        };

        const animateBlueOut = () => {
            const duration = gsap.utils.random(5, 10); // random duration between 1s and 3s
            
            gsap.fromTo('.outline1', { drawSVG: "100%"}, { drawSVG: "0%", duration: duration, ease: "power1.inOut" });
            gsap.fromTo('.outline2', { drawSVG: "100%"}, { drawSVG: "0%", duration: duration, ease: "power1.inOut", onComplete: animateBlueIn });
        };

        const animatePinkIn = () => {
            let duration = gsap.utils.random(5, 10); // random duration between 1s and 3s
            let delay = gsap.utils.random(0, 5);  // random delay between 0.5s and 2s

            gsap.fromTo('.outline3', { drawSVG: "0%"}, { drawSVG: "100%", duration: duration, delay: delay, ease: "power1.inOut", onComplete: animatePinkOut });
        };

        const animatePinkOut = () => {
            let duration = gsap.utils.random(5, 10); // random duration between 1s and 3s

            gsap.fromTo('.outline3', { drawSVG: "100%"}, { drawSVG: "0", duration: duration, ease: "power1.inOut", onComplete: animatePinkIn });
        };

        animateBlueIn();
        animatePinkIn();
    }, []);

    //Clock Animation
    useEffect(() => {
        const interval = setInterval(() => {
        setClock(); console.log("Clock set");
        }, 60000); // 60000 ms = 1 minute

        return () => clearInterval(interval); // cleanup on unmount
    }, []);

    const setClock = () => {
        const now = new Date();
        const hours = now.getHours();   // returns 0–23
        const minutes = now.getMinutes(); // returns 0–59
        const hourRotation = (hours % 12) * 30 + (minutes / 60) * 30;
        
        gsap.set('.hours', { rotation: hourRotation, transformOrigin: "50% 50%" });
        gsap.set('.minutes', { rotation: (minutes * 6), transformOrigin: "50% 50%"});
    };

    setClock();

    return (
            <svg className="w-[20%] w-[20%] md:w-[75%] w-[75%]" viewBox="0 0 1256 1352" preserveAspectRatio="xMidYMid meet">
                <image href={AnimatedHeart_aorta.src} className="absolute w-full h-full object-contain aorta" />
                <image href={AnimatedHeart_cava.src} className="absolute w-full h-full object-contain cava" />
                <image href={AnimatedHeart_artery.src} className="absolute w-full h-full object-contain artery" />
                <path fillOpacity="0.5" className="outline2 absolute w-full h-full object-contain" stroke="#00a3d4" fill="none" strokeWidth="5" d="M521.33,147.09c-38.67-8.83-55.83,40.13-88,48-4.18-11.63-31.34-86.39-38-90-2.67-.33-5.33-.67-8-1-23.22,12.13-60.93,21.19-68,48-2.79,13.36,14.38,30.62,18,43,11.48,39.2,20.15,93.72,12,143-13.17,79.63-46.19,135.97-60,213-3.53,19.71,2.07,33.84,5,48,5.64,27.25,1.89,77.39-9,95,35.01-14.03,60.42-40.74,89-61,24.66-13.67,49.34-27.33,74-41,12.22-56.82-1.95-80.06-10-129-4.53-27.56,3.06-66.27,11-86,5-10.67,10-21.33,15-32-.32-24.21-1.76-50.29,6-69,6.33-15.25,23.46-33.67,37-42,10.42-6.41,22.66-8.7,29-19,13.27-21.56-5.37-55.4-15-68ZM330.33,153.09c-12.58-11.55,37.9-37.65,47-43h5c2,2,4,4,6,6-1.95,15.59-39.89,46.54-58,37ZM531.33,207.09c-1.8,2.02.02.74-3,2-19.84-9.62-28.9-39.46-13-57,1.67.33,3.33.67,5,1,10.72,5.86,19.09,37,11,54ZM457.33,591.09v-1h-4c1.33.33,2.67.67,4,1Z"/>
                <image href={AnimatedHeart_heart.src} className="absolute w-full h-full object-contain heart" />
                <image href={AnimatedHeart_veins.src} className="absolute w-full h-full object-contain veins" />
                <image href={AnimatedHeart_atrium.src} className="absolute w-full h-full object-contain atrium" />
                <path fillOpacity="0.5" className="outline1 absolute w-full h-full object-contain" stroke="#00a3d4" fill="none" strokeWidth="5" d="M995.99,323.78c2.33,2.67,4.67,5.33,7,8h1c-1-3.33-2-6.67-3-10-7.76-2.35-17.61-3.27-29-3,5.12-6.78,7.24-11.13,5-21-25.28-19.59-42.9,12.17-72,19-23.33,4-46.67,8-70,12-48.13,12.74-121.91,45.91-177,23-40.44,18.96-70.47,99.68-38,150-21,16-42,32-63,48-7.67,8-15.33,16-23,24-20.66,4.33-41.34,8.67-62,13-25.5,8.66-54.66,24.65-78,40-20.8,13.67-75.58,65.42-99,66-1.85,9.45-.17,22.83-5,32-10.54,19.99-25.22,31.19-27,63h-5c-.33.67-.67,1.33-1,2v37c5.67,20.33,11.33,40.67,17,61,13,24.33,26,48.67,39,73,8.67,10,17.33,20,26,30,31.85,50.06,70.05,90.92,106,136,29.97,37.59,62.95,74.44,101,104,37.58,29.2,129.51,94.22,200,64,62.15-26.65,94.64-87.05,122-149,6.33-12,12.67-24,19-36,11-29.66,22-59.34,33-89,18.28-43.11,42.12-88.61,52-140,3.8-19.79,6.76-51.69,2-72-9.17-39.11-29.44-61.15-43-92-23.09-52.55-46.22-116.97-94-145-16.67-9.78-48.27-10.05-71-13,23.85-37.92,25.27-96.82,68-116,33.06-14.84,150.34-20.46,165-43-39.13,7.45-17.76-61.75-10-75,2.33-.33,4.67-.67,7-1ZM650.99,541.78c-3.67,4-7.33,8-11,12,7.02,5.03,22.03-5.62,27-10,5.33,2.67,10.67,5.33,16,8,9.18,2.63,25.45-10.52,30-17,5.22,3.1-21.38,18.24-26,21-9.41-1.08-10.58-5.24-19-7-30.03,14.17-88.69,43.82-67,91-3.33,2.67-6.67,5.33-10,8,1.09-18.19-8.88-27.5-23-33-.33-.67-.67-1.33-1-2,35.95-14.26,47.88-50.57,84-71ZM676.99,673.78v1c-18.05,4.03-39.76-23.09-62-29,4.78-4.53,13.75-1.1,22,0,.64-9.73,4.42-13.49,8-20-.67,7.67-1.33,15.33-2,23,3.37,12.11,22.37,20.58,34,25ZM393.99,630.78c3-1.33,6-2.67,9-4,1.33.67,2.67,1.33,4,2h2c-19.83,26.17-8.4,68.65,21,80,2,2.33,4,4.67,6,7-9.67-6.33-19.33-12.67-29-19-1.11,25.19-3.42,47.3,2,72,3.95,18,10.64,26.67,9,50-1,.67-2,1.33-3,2,2.58-28.76-8.26-48.78-15-74-4.4-16.48-2.67-44.24-5-59-.67-.33-1.33-.67-2-1-5.99,20.82-22.86,40.29-15,73,4.33,9.67,8.67,19.33,13,29,3.82,19.15,1.45,34.62,8,48-18.66-15.84-3.93-63.68-26-77-.67-.67-1.33-1.33-2-2-8.47,18.57-5.65,39.65-2,62v27c6.33,13.67,12.67,27.33,19,41-.33,1-.67,2-1,3h-1c-5.25-17.51-14.99-29.21-21-45-2.4-6.3-6.53-50.92-7-59-.38-6.54,14.69-77.15,18-84,4-6.33,8-12.67,12-19-.33-5.67-.67-11.33-1-17,2.33-12,4.67-24,7-36ZM382.99,959.78c4.33,2.67,8.67,5.33,13,8,6.73,8.36,5.29,20.6,9,32,7.03,21.57,26.84,35.66,50,42,1,1.33,2,2.67,3,4-5.43-2.33-12.28-4.91-19-3-11-10.33-22-20.67-33-31-7.86-15.3-7.03-29.93-16-43-9.3-13.54-23.57-18.53-31-36-3.66-8.61-1.78-18.52-5-29-6.69-21.77-28.68-62.43-48-72-5.77-14.2,7.56-32.09-6-49-.33-.67-.67-1.33-1-2-10.14,106.88,20.79,168.74,66,226,13.33,13.33,26.67,26.67,40,40-76.94-45.69-136.71-175.09-106-303,2-14.33,4-28.67,6-43,9.59-23.44,49.29-21.68,59-45,3-1,6-2,9-3h5c.33.67.67,1.33,1,2-13.79,15.83-57.56,29.21-66,47-.67,7-1.33,14-2,21-3.1,11.25-11.92,27.88-9,44,3.14,17.31,10.98,32,9,56-1.02,12.32,27.67,28.56,35,39,3.67,11.33,7.33,22.67,11,34,5.9,8.78,16.54,13.56,25,20,10.1,7.7,14.8,22.85,25,31,17.46,13.94,37.49,27.21,51,45-1,.33-2,.67-3,1-19.33-16.67-38.67-33.34-58-50-14.81-14.66-18.4-24.48-38-37,5.26,23.43,9.85,40.11,24,54ZM611.99,1215.78h-1c1.66-13.85,4.67-20.14,13-27-4,8.33-8,16.67-12,25v2ZM613.99,1241.78c4,6.67,8,13.33,12,20-6.4-4.54-11.84-8.99-12-20ZM628.99,1235.78c-5.67-13.89,4.62-30.55,2-45-2.39-13.2-7.32-24.13-7-44,32.52,28.39,2.72,48.62,9,81,3.33,17.17,33.64,33.53,49,39h7c-4-2.67-8-5.33-12-8h-2v-1c10.47.97,21.76,4.4,28,10-26.39,5.59-66.08-12.59-74-32ZM743.99,1004.78c8.67,11.33,17.33,22.67,26,34-9.81-5.8-24.31-21.23-26-34ZM837.99,818.78c-4-.33-8-.67-12-1-.67,1-1.33,2-2,3,1.33,1,2.67,2,4,3,1.33,1.67,2.67,3.33,4,5h-6c-.66,12.53,10.25,20.89,16,30,13.4,21.23,51.38,73.42,51,106h-1c-3.08-16.66-26.42-69.89-42-72,.64,28.29,3.78,49.73,5.93,73.43.36,1.19.71,2.38,1.07,3.57.21,2.16.09,4.65-.18,7.33.77,10.63,1.26,21.94,1.18,34.67l-1-1c-4.97-8.58-1.28-22.75-.18-33.67-.27-3.71-.57-7.33-.89-10.91-3.64-12.14-7.29-24.29-10.93-36.43h-1c-5.23,9.86-8.47,23.3-9,37l-1,1h-1c-5.84-24.04,12.39-47.78,11-69-1.63-25.01-44.29-94.26-60-107,.67-2.67,1.33-5.33,2-8v-2c18.99,14.74,18.66,31.33,51,35,.33.67.67,1.33,1,2ZM806.99,573.78c2.16,2-9.55,14-12,16-12.79,10.42-35.38,30.22-30,57,6.85,34.09,15.71,55.09,9,94-2.76,15.99,2.73,29.59-2,43-11.67,17.33-23.33,34.67-35,52-4,18-8,36-12,54-15.95,40.44-39.41,74.03-60,109-5.67,13.67-11.33,27.33-17,41-8.71,13.02-19.54,24.86-26,41-11.42,28.54-27.87,156.2-14,184-16.36-2.45-11.58-22-15-37-6.12-26.8,4.37-62.02,9-91-.33-6-.67-12-1-18,1.58-7.23,6.67-10.22,8-19v-1c-8.44,1.23-51.51,28.39-62,36-5,6-10,12-15,18,1.67-6.33,3.33-12.67,5-19-6.67-1-13.33-2-20-3-21.07-7.84-41.57-23.84-53-42v-1c8.13,4.03,10.25,12.91,17,18,14.67,8,29.33,16,44,24,17.28,3.8,65.08-27.33,76-35,17.52-12.31,18.68-26.39,30-45,6-7.67,12-15.33,18-23,3.67-12.33,7.33-24.67,11-37,10.02-19.89,25.51-41.32,37-61,10.26-17.57,16.54-41.4,24-61,1.33-12.33,2.67-24.67,4-37-10.79-8.53-46.27,16.22-58,21-15.98,6.5-30.97,10.84-43,21-24.48,20.66-37.65,59.37-55,87-7.67,9-15.33,18-23,27-9.86,13.92-7.45,31.83-22,41,20.48-50.16,55.96-83.3,75-134-21.21,4.9-49.01-4.32-75,1-12.1,2.48-23.66,8.07-38,10,17.41-16.16,60.87-14.54,88-20,10.67-.67,21.33-1.33,32-2,12.44-6.38,19.84-25.34,33-33,13.33-4.33,26.67-8.67,40-13,6.33-3.33,12.67-6.67,19-10,9.33-2,18.67-4,28-6,9.81-6.12,28.31-48.86,31-64-.33-8-.67-16-1-24,2.01-11.31,8.86-23.59,6-39-5.67-15.33-11.33-30.67-17-46-.33,3-.67,6-1,9-4.09-8.37-8.85-35.19-10-44,10.38,4.63,18.5,13.64,22,25,1,.67,2,1.33,3,2,3.6-44.69,23.7-44.29,48-66ZM965.99,317.78c-4.88,1.24-12.73,3.33-18,1h-2c2.81-9.49,6.75-14.21,13-20,7.21.52,8.21,2.4,11,7-.28,6.68-1.5,8.19-4,12Z"/>
                <path fillOpacity="0.5" className="outline3 absolute w-full h-full object-contain" stroke="#e20e7f" fill="none" strokeWidth="5" d="M812.79,342.24c5.08-35.94-37.27-83.31-59-98-11.63-7.86-37.21-16.13-41-31-7-27.49,22.44-76.44,33-90,6.98-8.96,17.22-10.22,18-26-8.59-9.28-36.8-33.08-57-19-5.55,3.95-37.58,82.71-42,95-4.46,12.41-3.29,30.79-14,37-2.33.33-4.67.67-7,1-9.33-18.25-2.37-109.01-2-136-11.96-7.36-33.37-4.65-48-2-7.62,11.66-1.52,29.42,1,46-1.33,32.33-2.67,64.67-4,97-2.84,8.38-9.54,15.11-16,20-5.47,1.09-9.33.39-14-1-17.82-29.16-27.94-65.94-42-98-5.53-12.62-16.71-25.34-18-41-8.78-5.47-19.82-3.16-29,0h17l1,2c-6.46,8.74-23.59,19.01-40,14-.33,1.33-.67,2.67-1,4-2.6,11.65,13.05,31.05,18,41,14.15,28.46,43.21,75.24,34,121-4.88,24.22-23.94,38.32-35,57-22.68,38.31-41.43,93.73-32,154-10.1-7.54-8.94-17.15-16-28-5.67-4.33-11.33-8.67-17-13-6.7-10.06-5.81-37.31-6-52-3.78-3.47-4.38-5.91-11-7-13.79-3.75-38.41,27.21-48,34-83.35,58.99-104.06,96-124,218-6.08,37.17.3,147.35,24,156,2.95,2.16,3.72,1.38,9,1,3.58-42.53,32.27-53.06,32-94,15.45-4.19,17.9-17.53,30-23,16.2-7.32,31.1-7.49,44-17,7.18-5.29,11.01-18.6,18-23,6.67-1.33,13.33-2.67,20-4,15.1-7.27,13.71-16.4,22-31,7.67-6.33,15.33-12.67,23-19,10.62-15.51,2.88-36.24,11-50v-2c10.64,14.56-1.53,52.89-4,68,20.16-9.65,55.65-8.19,75-19,7.67-8,15.33-16,23-24,20-15,40-30,60-45,1.7-3.39-13.87-46.77-9-71,2.85-14.2,3.62-29.37,10-40,14.1-23.49,66.38-79.25,96-35,38.33-9,76.67-18,115-27h2ZM1052.79,444.24c-7.98-2.71-16.84-2.24-29-2,5.27-6.91,13.58-23.93,7-36-3.27-7.13-10.17-9.48-19-11-10,4.67-20,9.33-30,14-7.77,4.78-8.6,13.22-20,16-51.7,12.59-114.66,5.89-153,32-20.53,13.99-32.78,36.75-41,63-5.83,18.61-8.37,38.38-22,49v4c8.42,5.62,35.66,8.03,48,5-3.33,6-6.67,12-10,18-5.5,7.05-15.34,6.11-19,16-3.54,9.58,3.8,19.86,1,28-2.67,3.33-5.33,6.67-8,10-5.12,17.54,15.8,52.99,21,69,13.48,8.82,29.04,6.55,45,4,4,7.33,8,14.67,12,22,9.06,6.41,17.7.55,29,4,6.56,2,13,9.04,22,10,14-2.67,28-5.33,42-8,21.25-41.79,23.5-86.84,1-128,28.71-26.17,10.13-62.98,14-102,3-1.67,6-3.33,9-5,3.8,2.7,14.88,3.17,20,7,10.07,7.53,11.44,35.74,36,25,10.16-3.64,12.17-13.04,15-24-3.65-8.8-10.75-18.83-21-21-.05-6.45-.89-8.36-3-12,.33-.33.67-.67,1-1,15.52,1.79,23.96,16.78,39,15,23.59-2.79,23.28-42.45,13-61ZM1012.79,527.24c1.46,2.88,2.55,5.27,1,9-3.04,4.81-8.17,6.96-16,7-.67-.33-1.33-.67-2-1-3.09-4.87-3.5-8.23-3-15,2.33-1.33,4.67-2.67,7-4,6.93.47,8.21,2.11,13,4ZM1012.79,442.24c-5.24,2.52-10.37,1.5-17,1v-1c5.54-10.32,11.91-19.14,21-26,2,.33,4,.67,6,1,1,.67,2,1.33,3,2-.43,11.16-4.58,19.7-13,23ZM1046.79,493.24c-1.67.67-3.33,1.33-5,2-2-1-4-2-6-3-4.12-5.77-9.08-16.89-4-26,2.67-2.67,5.33-5.33,8-8,2,.33,4,.67,6,1,5.51,9.76,3.24,23.34,1,34Z"/>
                <image href={AnimatedHeart_minutes.src} className="absolute w-full h-full object-contain minutes" />
                <image href={AnimatedHeart_hours.src} className="absolute w-full h-full object-contain hours" />
            </svg>
   
   
    );
};

export default AnimatedHeart;